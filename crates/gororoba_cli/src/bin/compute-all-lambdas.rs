//! Compute lambda coupling strength for all materials in registry
//!
//! Generates TOML output for insertion into registry/materials_viscosity.toml
//!
//! Usage:
//! ```bash
//! cargo run --bin compute-all-lambdas
//! ```

use materials_core::list_viscosity_materials;
use vacuum_frustration::predict_lambda_sedenion;

fn main() -> Result<(), Box<dyn std::error::Error>> {
    println!("# Lambda coupling strength for all materials (F=0.35)");
    println!("# Generated by: compute-all-lambdas binary");
    println!("# Date: 2026-02-11");
    println!();

    let frustration = 0.35; // Typical frustrated value near vacuum attractor

    // Get all material IDs
    let material_ids = list_viscosity_materials();

    println!("# Total materials: {}", material_ids.len());
    println!();

    for id in material_ids {
        let material = materials_core::get_viscosity_material(&id)
            .expect("Material should exist");

        // Only compute lambda for materials with temperature
        let lambda = predict_lambda_sedenion(frustration, material.temperature_K);

        // Determine coupling regime
        let regime = if lambda > 100.0 {
            "STRONG"
        } else if lambda > 10.0 {
            "MODERATE"
        } else if lambda > 1.0 {
            "WEAK"
        } else {
            "VERY_WEAK"
        };

        println!("[[lambda_result]]");
        println!("material_id = \"{}\"", id);
        println!("material_name = \"{}\"", material.name);
        println!("temperature_K = {}", material.temperature_K);
        println!("lambda_computed = {:.4}", lambda);
        println!("coupling_regime = \"{}\"", regime);

        // Add interpretation based on regime
        let interpretation = match regime {
            "STRONG" => "Frustration dominates, strong viscosity modulation",
            "MODERATE" => "Frustration and thermal energy comparable",
            "WEAK" => "Thermal fluctuations dominate",
            "VERY_WEAK" => "Thermal effects completely dominate",
            _ => "Unknown regime",
        };
        println!("interpretation = \"{}\"", interpretation);
        println!();
    }

    Ok(())
}
